#!/usr/bin/env ruby
require 'morpheus/cli'
require 'morpheus/rest_client'
require 'morpheus/cli/cli_registry'

# short circuit version switch
if ARGV[0] == '-v' && ARGV.size == 1
  version = Morpheus::Cli::VERSION
  puts version
  exit 0
end

# parse args to handle global issues
# JD: figure out what to do with --insecure option
if ARGV.find {|arg| arg == '--insecure'}
  Morpheus::RestClient.enable_ssl_verification = false
end
filtered_args = ARGV.find_all {|arg| arg != '--insecure'}

# all commands should be registered commands
if Morpheus::Cli::CliRegistry.has_command?(ARGV[0])
  Morpheus::Cli::CliRegistry.exec(ARGV[0], filtered_args[1..-1])
  exit 0
else
  puts "\nUsage: morpheus [command] [options]\n"
  puts "\nCommands:\n"
  Morpheus::Cli::CliRegistry.all.each {|cmd,klass|
    puts "\t#{cmd.to_s}"
  }
  puts ""
  exit 127
end
